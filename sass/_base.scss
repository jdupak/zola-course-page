// Base HTML & Layout

body {
    min-width: $body-min-width;
    color: var(--body-font-color);
    background: var(--body-background);

    font-weight: $body-font-weight;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;

    font-family:
        BlinkMacSystemFont,
        -apple-system,
        "Segoe UI",
        "Roboto",
        "Oxygen",
        "Ubuntu",
        "Cantarell",
        "Fira Sans",
        "Droid Sans",
        "Helvetica Neue",
        "Helvetica",
        "Arial",
        sans-serif;

    // Layout Flex
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

h1,
h2,
h3,
h4,
h5 {
    font-weight: $body-font-weight;
}

a {
    text-decoration: none;
    color: var(--color-link);
}

:focus {
    @include outline;
}

// Fonts
@font-face {
    font-family: "Roboto";
    font-style: italic;
    font-weight: 300;
    font-display: swap;
    src:
        local("Roboto Light Italic"),
        local("Roboto-LightItalic"),
        url("fonts/roboto-v19-latin-300italic.woff2") format("woff2");
}

@font-face {
    font-family: "Roboto";
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src:
        local("Roboto"),
        local("Roboto-Regular"),
        url("fonts/roboto-v19-latin-regular.woff2") format("woff2");
}

@font-face {
    font-family: "Roboto";
    font-style: normal;
    font-weight: 700;
    font-display: swap;
    src:
        local("Roboto Bold"),
        local("Roboto-Bold"),
        url("fonts/roboto-v19-latin-700.woff2") format("woff2");
}

@font-face {
    font-family: "Roboto Mono";
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src:
        local("Roboto Mono"),
        local("RobotoMono-Regular"),
        url("fonts/roboto-mono-v6-latin-regular.woff2") format("woff2");
}

code {
    font-family: "Roboto Mono", monospace;
}

// Print
@media print {
  .course-menu,
  .course-footer,
  .course-toc {
    display: none;
  }

  .course-header {
    display: block;
  }

  main {
    // Fix for https://bugzilla.mozilla.org/show_bug.cgi?id=939897
    display: block !important;
  }
}

// Utility Classes

.flex {
  display: flex;
}

.flex-wrap {
  flex-wrap: wrap;
}

.justify-between {
  justify-content: space-between;
}

.align-center {
  align-items: center;
}

.hidden {
  display: none;
}

input.toggle {
  height: 0;
  width: 0;
  overflow: hidden;
  opacity: 0;
  position: absolute;
}

.container {
    width: 100%;
    max-width: $container-max-width;
    margin: 0 auto;
    overflow-x: hidden;
}

// Main Layout

.course-page {
    min-width: 0;
    flex-grow: 1;
    padding: $padding-16;
    overflow-wrap: break-word;

    @media screen and (min-width: $container-max-width) {
        padding: 0.5rem $padding-16 ($padding-16 * 2);
    }
}

// Header / Footer

.course-header {
    display: none;
    margin-bottom: $padding-16;

    label {
        line-height: 0;
    }
}

.course-footer {
    padding-top: $padding-16;
    margin-top: $padding-16 * 2;
    font-size: $font-size-14;

    img {
        height: 1em;
        margin-inline-end: $padding-8;
    }

    .flex-wrap {
        gap: $padding-16;
    }

    p {
        margin: 0 0 $padding-4;
        font-size: $font-size-12;
        opacity: 0.7;
    }
}

// Sidebars

// --- Left Sidebar (Menu) ---
.course-menu {
    flex: 0 0 $menu-width;
    font-size: $font-size-14;

    @media screen and (max-width: 1400px) and (min-width: $mobile-breakpoint) {
        flex: 0 0 12rem;
    }
}

.course-menu-content {
    width: $menu-width;
    padding: $padding-16;
    padding-left: 0.5rem;
    padding-right: 0.5rem;

    position: sticky;
    top: 0;
    height: 100vh;
    overflow-x: hidden;
    overflow-y: auto;

    @media screen and (max-width: 1400px) and (min-width: $mobile-breakpoint) {
        width: 12rem;
    }
}

// --- Right Sidebar (TOC) ---
.course-toc {
    flex: 0 0 $toc-width;
    font-size: $font-size-12;

    @media screen and (max-width: 1400px) and (min-width: $mobile-breakpoint) {
        flex: 0 0 12rem;
    }
}

.course-toc-content {
    width: $toc-width;
    padding: $padding-16;
    padding-left: 0.5rem;
    padding-right: 0.5rem;

    position: sticky;
    top: 0;
    height: 100vh;
    overflow-x: hidden;
    overflow-y: auto;

    @media screen and (max-width: 1400px) and (min-width: $mobile-breakpoint) {
        width: 12rem;
    }
}

// Hide mobile TOC on desktop
.course-toc-mobile {
    display: none;
}


// Responsive / Mobile

@media screen and (max-width: $mobile-breakpoint) {
    // Toggle controls for mobile
    #menu-control,
    #toc-control {
        display: inline;
    }

    // Hide desktop ToC on mobile
    .course-toc {
        display: none;
    }

    .course-header {
        display: block; // Show hamburger/controls
    }

    // Unified Mobile Sidebar
    .course-menu,
    .course-toc-mobile {
        display: block; // Re-enable mobile toc
        position: fixed;
        top: 0;
        bottom: 0;
        z-index: 5;
        visibility: hidden;
        background: var(--body-background);
        overflow-y: auto;

        // Clear content under topbar
        padding-top: $topbar-height;

        transition:
            transform 0.2s ease-in-out,
            visibility 0.2s ease-in-out;
    }
    
    // Override sticky behaviors for mobile
    .course-menu .course-menu-content,
    .course-toc-mobile .course-toc-mobile-content {
        position: static;
        width: 100%;
        height: auto;
        padding: $padding-16; // Reset padding
    }

    .course-menu {
        left: 0;
        width: $menu-width;
        transform: translateX(-100%);
        font-size: $font-size-base;
    }

    .course-toc-mobile {
        right: 0;
        width: $toc-width;
        transform: translateX(100%);
        font-size: $font-size-12; 
    }

    // Sidebar Active State
    #menu-control:checked ~ main .course-menu {
        visibility: visible;
        transform: translateX(0);
        box-shadow: 2px 0 $padding-8 rgba(0, 0, 0, 0.1);
    }

    #toc-control:checked ~ main .course-toc-mobile {
        visibility: visible;
        transform: translateX(0);
        box-shadow: -2px 0 $padding-8 rgba(0, 0, 0, 0.1);
    }

    // Overlay
    .sidebar-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.3);
        z-index: 4;
        cursor: pointer;
    }

    #menu-control:checked ~ main .sidebar-overlay-menu,
    #toc-control:checked ~ main .sidebar-overlay-toc {
        display: block;
    }
}
